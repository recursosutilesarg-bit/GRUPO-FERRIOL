<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#1e1b4b">
  <title>Ferriol OS — Sistema de Gestión Premium</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root {
      --indigo-deep: #1e1b4b; --indigo-mid: #3730a3; --violet-electric: #7c3aed;
      --violet-light: #a78bfa; --white-pure: #ffffff; --glass-bg: rgba(255,255,255,0.08);
      --glass-border: rgba(255,255,255,0.18); --glow-violet: rgba(124,58,237,0.4);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: linear-gradient(135deg, #0f0a1e 0%, #1e1b4b 40%, #312e81 70%, #1e1b4b 100%);
      min-height: 100vh; color: var(--white-pure); overflow-x: hidden;
    }
    .glass { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); }
    .glass-strong { background: rgba(255,255,255,0.12); backdrop-filter: blur(24px); border: 1px solid rgba(255,255,255,0.2); }
    .btn-glow { background: linear-gradient(135deg, var(--violet-electric), var(--indigo-mid)); box-shadow: 0 0 24px var(--glow-violet); }
    #loginScreen { position: fixed; inset: 0; z-index: 200; display: flex; align-items: center; justify-content: center; padding: 1.5rem; background: #0f0a1e; }
    .login-glass { background: rgba(30,27,75,0.75); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 2rem; width: 100%; max-width: 400px; }
    input { width: 100%; padding: 0.75rem 1rem; background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.15); border-radius: 0.5rem; color: #fff; margin-bottom: 1rem; }
    .btn-login { width: 100%; padding: 0.75rem; background: var(--violet-electric); color: #fff; font-weight: 600; border-radius: 0.5rem; border: none; cursor: pointer; }
    .login-err { background: rgba(239,68,68,0.2); color: #fca5a5; padding: 0.5rem; border-radius: 0.5rem; font-size: 0.9rem; margin-bottom: 1rem; display: none; }
    .login-err.show { display: block; }
    .hidden { display: none !important; }
    .panel { animation: slideUp 0.35s ease-out; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div id="loginScreen">
    <div class="login-glass">
      <h1 class="text-2xl font-bold mb-2">Ferriol OS</h1>
      <p class="text-white/60 mb-6 text-sm">Iniciá sesión para gestionar tu kiosco</p>
      <div id="loginErr" class="login-err"></div>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginPassword" placeholder="Contraseña" required>
        <button type="submit" class="btn-login">Ingresar al Sistema</button>
      </form>
    </div>
  </div>

  <div id="appWrap" class="hidden">
    <header class="glass-strong border-b border-white/10 px-4 py-3 sticky top-0 z-50">
      <div class="flex items-center justify-between max-w-7xl mx-auto">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl btn-glow flex items-center justify-center">
            <i data-lucide="sparkles" class="w-5 h-5"></i>
          </div>
          <div>
            <h1 class="font-bold text-lg" id="headerTitle">Ferriol OS</h1>
            <p class="text-xs text-white/60">Sistema Premium</p>
          </div>
        </div>
        <button id="logoutBtn" class="p-2.5 glass rounded-xl"><i data-lucide="log-out" class="w-5 h-5"></i></button>
      </div>
    </header>

    <nav id="navKiosquero" class="glass border-b border-white/10 p-2 flex gap-2 overflow-x-auto">
      <button data-nav="dashboard" class="px-4 py-2 rounded-lg text-sm bg-white/10">Dashboard</button>
      <button data-nav="inventory" class="px-4 py-2 rounded-lg text-sm">Inventario</button>
    </nav>

    <main class="p-4 max-w-7xl mx-auto">
      <section id="panel-dashboard" class="panel">
        <div class="glass rounded-2xl p-6">
          <h2 class="text-xl font-bold mb-4">¡Bienvenido al Panel!</h2>
          <p class="text-white/70">El sistema está conectado y funcionando.</p>
        </div>
      </section>

      <section id="panel-super" class="panel hidden text-center">
        <div class="glass rounded-2xl p-6">
          <h2 class="text-xl font-bold mb-2">Panel de Control Súper</h2>
          <p class="text-violet-300">Acceso total habilitado para Gustavo</p>
        </div>
      </section>
    </main>
  </div>

  <script>
    lucide.createIcons();

    // CREDENCIALES
    const SUPABASE_URL = 'https://ctvdrqxnrrjfwifixecf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN0dmRycXhucnJqZndpZml4ZWNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzNzY5NjcsImV4cCI6MjA4Njk1Mjk2N30.U2Y5IBY7fSFjmgiGkyYX8BLdRyU1ZNFqVEEIaT7QIJI';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;

    // LOGIN
    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const pass = document.getElementById('loginPassword').value;
      const errEl = document.getElementById('loginErr');
      
      try {
        errEl.classList.remove('show');
        const { data: authData, error: authErr } = await supabase.auth.signInWithPassword({ email, password: pass });
        if (authErr) throw authErr;

        let { data: profile } = await supabase.from('profiles').select('*').eq('id', authData.user.id).single();
        
        if (!profile) {
          const role = (email === 'gustavoferriol1993@gmail.com') ? 'super' : 'kiosquero';
          const { data: newProf } = await supabase.from('profiles').insert({ id: authData.user.id, email, role, active: true }).select().single();
          profile = newProf;
        }

        currentUser = profile;
        showApp();
      } catch (err) {
        errEl.textContent = err.message;
        errEl.classList.add('show');
      }
    };

    function showApp() {
      const isSuper = currentUser && currentUser.role === 'super';
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('appWrap').classList.remove('hidden');
      
      if (isSuper) {
        document.getElementById('panel-dashboard').classList.add('hidden');
        document.getElementById('panel-super').classList.remove('hidden');
        document.getElementById('headerTitle').textContent = "Admin Mode";
      }
    }

    document.getElementById('logoutBtn').onclick = () => location.reload();
  </script>
</body>
</html>
